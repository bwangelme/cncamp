## linux 进程内存空间分配

![](https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-01-02-173542.png)

## 指令

`size` 查看一个程序各个段的大小

```shell
ø> size lock
   text    data     bss     dec     hex filename
1114879   98272  211880 1425031  15be87 lock

# data 表示初始化数据段
# bss 表示未初始化数据段
```

`objdump` 查看二进制文件中的内容

```
ø> objdump -x lock

lock：     文件格式 elf64-x86-64
lock
体系结构：i386:x86-64， 标志 0x00000112：
EXEC_P, HAS_SYMS, D_PAGED
起始地址 0x000000000045e700

程序头：
    PHDR off    0x0000000000000040 vaddr 0x0000000000400040 paddr 0x0000000000400040 align 2**12
         filesz 0x0000000000000188 memsz 0x0000000000000188 flags r--
    NOTE off    0x0000000000000f9c vaddr 0x0000000000400f9c paddr 0x0000000000400f9c align 2**2
         filesz 0x0000000000000064 memsz 0x0000000000000064 flags r--
    LOAD off    0x0000000000000000 vaddr 0x0000000000400000 paddr 0x0000000000400000 align 2**12
         filesz 0x000000000008160c memsz 0x000000000008160c flags r-x
    LOAD off    0x0000000000082000 vaddr 0x0000000000482000 paddr 0x0000000000482000 align 2**12
         filesz 0x000000000008fe48 memsz 0x000000000008fe48 flags r--
    LOAD off    0x0000000000112000 vaddr 0x0000000000512000 paddr 0x0000000000512000 align 2**12
         filesz 0x0000000000018000 memsz 0x000000000004bba8 flags rw-
   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**3
         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-
0x65041580 off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**3
         filesz 0x0000000000000000 memsz 0x0000000000000000 flags --- 2a00

节：
Idx Name          Size      VMA               LMA               File off  Algn
  0 .text         0008060c  0000000000401000  0000000000401000  00001000  2**5
                  CONTENTS, ALLOC, LOAD, READONLY, CODE
  1 .rodata       00037cab  0000000000482000  0000000000482000  00082000  2**5
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  2 .typelink     000004e4  00000000004b9e40  00000000004b9e40  000b9e40  2**5
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  3 .itablink     00000058  00000000004ba340  00000000004ba340  000ba340  2**5
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  4 .gosymtab     00000000  00000000004ba398  00000000004ba398  000ba398  2**0
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  5 .gopclntab    00057aa8  00000000004ba3a0  00000000004ba3a0  000ba3a0  2**5
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  6 .go.buildinfo 000001b0  0000000000512000  0000000000512000  00112000  2**4
                  CONTENTS, ALLOC, LOAD, DATA
  7 .noptrdata    00010600  00000000005121c0  00000000005121c0  001121c0  2**5
                  CONTENTS, ALLOC, LOAD, DATA
  8 .data         00007830  00000000005227c0  00000000005227c0  001227c0  2**5
                  CONTENTS, ALLOC, LOAD, DATA
  9 .bss          0002f020  000000000052a000  000000000052a000  0012a000  2**5
                  ALLOC
 10 .noptrbss     00004b88  0000000000559020  0000000000559020  00159020  2**5
                  ALLOC
 11 .debug_abbrev 00000210  0000000000000000  0000000000000000  0012a000  2**0
                  CONTENTS, READONLY, DEBUGGING, OCTETS
 12 .debug_line   00032190  0000000000000000  0000000000000000  0012a133  2**0
                  CONTENTS, READONLY, DEBUGGING, OCTETS
 13 .debug_frame  0000f45c  0000000000000000  0000000000000000  00146456  2**0
                  CONTENTS, READONLY, DEBUGGING, OCTETS
 14 .debug_gdb_scripts 0000003c  0000000000000000  0000000000000000  0014bbaa  2**0
                  CONTENTS, READONLY, DEBUGGING, OCTETS
 15 .debug_info   00080091  0000000000000000  0000000000000000  0014bbe6  2**0
                  CONTENTS, READONLY, DEBUGGING, OCTETS
 16 .debug_loc    0009ff87  0000000000000000  0000000000000000  00180b61  2**0
                  CONTENTS, READONLY, DEBUGGING, OCTETS
 17 .debug_ranges 00031710  0000000000000000  0000000000000000  0019c939  2**0
                  CONTENTS, READONLY, DEBUGGING, OCTETS
 18 .note.go.buildid 00000064  0000000000400f9c  0000000000400f9c  00000f9c  2**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
SYMBOL TABLE:
0000000000000000 l    df *ABS*  0000000000000000 go.go
0000000000401000 l     F .text  0000000000000000 runtime.text
0000000000402140 l     F .text  000000000000022d cmpbody
...
```

## Goroutine

![Goroutine 运行图](https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-01-06-091640.png)

![Goroutine 状态转换图](https://passage-1253400711.cos.ap-beijing.myqcloud.com/2023-01-06-091956.png)

## 内存管理

